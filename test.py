import os, json
from src.evaluation import answer_mapping
from src.scripts import *
from src.utils import *
def test_mapping(dir):
    with open(dir, 'r') as f:
        data = json.load(f)
    for d in data:
        mapped = answer_mapping(d['GENERATED'], num_shots = 3, lang="fr")




if __name__ == "__main__":
    #prompt = """\u8bf7\u4eff\u7167\u7ed9\u51fa\u7684\u4f8b\u5b50\uff0c\u9010\u6b65\u89e3\u7b54\u4e0b\u9762\u7684\u95ee\u9898\n\n\u95ee\u9898\uff1a\u7f57\u6770\u6709 5 \u4e2a\u7f51\u7403\u3002\u4ed6\u53c8\u4e70\u4e86 2 \u7f50\u7f51\u7403\u3002\u6bcf\u7f50\u6709 3 \u4e2a\u7f51\u7403\u3002\u4ed6\u73b0\u5728\u6709\u591a\u5c11\u4e2a\u7f51\u7403\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u7f57\u6770\u4e00\u5f00\u59cb\u6709 5 \u4e2a\u7403\u30022 \u7f50\u5404 3 \u4e2a\u7f51\u7403\u5c31\u662f 6 \u4e2a\u7f51\u7403\u30025 + 6 = 11\u3002\u7b54\u6848\u662f 11\u3002.\n\u95ee\u9898\uff1a\u670d\u52a1\u5668\u673a\u623f\u91cc\u6709\u4e5d\u53f0\u7535\u8111\u3002\u4ece\u5468\u4e00\u5230\u5468\u56db\uff0c\u6bcf\u5929\u53c8\u5b89\u88c5\u4e86\u4e94\u53f0\u7535\u8111\u3002\u670d\u52a1\u5668\u673a\u623f\u91cc\u73b0\u5728\u6709\u591a\u5c11\u53f0\u7535\u8111\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u4ece\u5468\u4e00\u5230\u5468\u56db\u6709 4 \u5929\u3002\u6bcf\u5929\u589e\u52a0 5 \u53f0\u7535\u8111\u3002\u8fd9\u610f\u5473\u7740\u4e00\u5171\u589e\u52a0\u4e86 4 * 5 = 20 \u53f0\u7535\u8111\u3002\u4e00\u5f00\u59cb\u6709 9 \u53f0\u7535\u8111\uff0c\u6240\u4ee5\u73b0\u5728\u6709 9 + 20 = 29 \u53f0\u7535\u8111\u3002\u7b54\u6848\u662f 29\u3002.\n\u95ee\u9898\uff1a\u5229\u4e9a\u6709 32 \u5757\u5de7\u514b\u529b\uff0c\u5979\u59b9\u59b9\u6709 42 \u5757\u3002\u5982\u679c\u5979\u4eec\u5403\u4e86 35 \u5757\uff0c\u5979\u4eec\u4e00\u5171\u8fd8\u5269\u4e0b\u591a\u5c11\u5757\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u5229\u4e9a\u6709 32 \u5757\u5de7\u514b\u529b\uff0c\u5229\u4e9a\u7684\u59b9\u59b9\u6709 42 \u5757\u3002\u8fd9\u610f\u5473\u7740\u539f\u6765\u6709 32 + 42 = 74 \u5757\u5de7\u514b\u529b\u300235 \u5757\u88ab\u5403\u6389\u4e86\u3002\u6240\u4ee5\u5979\u4eec\u4e00\u5171\u8fd8\u6709 74 - 35 = 39 \u5757\u5de7\u514b\u529b\u3002\u7b54\u6848\u662f 39\u3002.\n\u95ee\u9898\uff1a\u8096\u6069\u6709\u4e94\u4e2a\u73a9\u5177\u3002\u5723\u8bde\u8282\u4ed6\u4ece\u4ed6\u7238\u7238\u5988\u5988\u90a3\u91cc\u5404\u5f97\u5230\u4e86\u4e24\u4e2a\u73a9\u5177\u3002\u4ed6\u73b0\u5728\u6709\u591a\u5c11\u4e2a\u73a9\u5177\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u4ed6\u6709 5 \u4e2a\u73a9\u5177\u3002\u4ed6\u4ece\u5988\u5988\u90a3\u91cc\u5f97\u5230 2 \u4e2a\uff0c\u6240\u4ee5\u4e4b\u540e\u4ed6\u6709 5 + 2 = 7 \u4e2a\u73a9\u5177\u3002\u7136\u540e\u4ed6\u53c8\u4ece\u7238\u7238\u90a3\u91cc\u5f97\u5230\u4e86 2 \u4e2a\uff0c\u6240\u4ee5\u4ed6\u4e00\u5171\u6709 7 + 2 = 9 \u4e2a\u73a9\u5177\u3002\u7b54\u6848\u662f 9\u3002.\n\u95ee\u9898\uff1a\u8fc8\u514b\u5c14\u6709 58 \u4e2a\u9ad8\u5c14\u592b\u7403\u3002\u5468\u4e8c\uff0c\u4ed6\u4e22\u5931\u4e86 23 \u4e2a\u9ad8\u5c14\u592b\u7403\u3002\u5468\u4e09\uff0c\u4ed6\u53c8\u4e22\u5931\u4e86 2 \u4e2a\u3002\u5468\u4e09\u7ed3\u675f\u65f6\u4ed6\u6709\u591a\u5c11\u4e2a\u9ad8\u5c14\u592b\u7403\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u8fc8\u514b\u5c14\u4e00\u5f00\u59cb\u6709 58 \u4e2a\u9ad8\u5c14\u592b\u7403\uff0c\u4e22\u5931\u4e86 23 \u4e2a\uff0c\u6240\u4ee5\u4ed6\u6709 58 - 23 = 35 \u4e2a\u3002\u5728\u4ed6\u53c8\u4e22\u5931\u4e86 2 \u4e2a\u540e\uff0c\u4ed6\u73b0\u5728\u6709 35 - 2 = 33 \u4e2a\u7403\u3002\u7b54\u6848\u662f 33\u3002.\n\u95ee\u9898\uff1a\u5965\u5229\u7ef4\u4e9a\u6709 23 \u7f8e\u5143\u3002\u5979\u4e70\u4e86\u4e94\u4e2a\u5355\u4ef7 3 \u7f8e\u5143\u7684\u767e\u5409\u997c\u3002\u5979\u8fd8\u5269\u591a\u5c11\u94b1\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a5 \u4e2a\u5355\u4ef7 3 \u7f8e\u5143\u7684\u767e\u5409\u997c\u5e94\u8be5\u82b1\u8d39 5 * 3 = 15 \u7f8e\u5143\u3002\u5965\u5229\u7ef4\u4e9a\u4e00\u5f00\u59cb\u6709 23 \u7f8e\u5143\uff0c\u6240\u4ee5\u73b0\u5728\u5979\u8fd8\u5269 23 - 15 = 8 \u7f8e\u5143\u3002\u7b54\u6848\u662f 8\u3002.\n\u95ee\u9898\uff1a\u6770\u68ee\u6709 20 \u6839\u68d2\u68d2\u7cd6\u3002\u4ed6\u7ed9\u4e86\u4e39\u5c3c\u4e00\u4e9b\u68d2\u68d2\u7cd6\u3002\u73b0\u5728\u6770\u68ee\u6709 12 \u6839\u68d2\u68d2\u7cd6\u3002\u6770\u68ee\u7ed9\u4e86\u4e39\u5c3c\u591a\u5c11\u6839\u68d2\u68d2\u7cd6\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u6770\u68ee\u4e00\u5f00\u59cb\u6709 20 \u6839\u68d2\u68d2\u7cd6\uff0c\u4f46\u73b0\u5728\u4ed6\u53ea\u6709 12 \u6839\u4e86\uff0c\u6240\u4ee5\u4ed6\u7ed9\u4e86\u4e39\u5c3c 20 - 12 = 8 \u6839\u68d2\u68d2\u7cd6\u3002\u7b54\u6848\u662f 8\u3002.\n\u95ee\u9898\uff1a\u5982\u679c\u505c\u8f66\u573a\u91cc\u6709 3 \u8f86\u8f66\uff0c\u53c8\u6765\u4e86 2 \u8f86\u8f66\uff0c\u505c\u8f66\u573a\u91cc\u6709\u591a\u5c11\u8f86\u8f66\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a\u4e00\u5f00\u59cb\u6709 3 \u8f86\u8f66\uff0c\u53c8\u6765\u4e86 2 \u8f86\uff0c\u6240\u4ee5\u73b0\u5728\u5e94\u8be5\u6709 3 + 2 = 5 \u8f86\u8f66\u3002\u7b54\u6848\u662f 5\u3002.\n\n\u95ee\u9898\uff1a\u5468\u4e00\uff0c\u82cf\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684 4 \u500d\u3002\u5468\u4e8c\uff0c\u5979\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684\u4e24\u500d\u3002\u5979\u59b9\u59b9\u5468\u4e00\u5403\u4e86 5 \u5757\u997c\u5e72\uff0c\u7b2c\u4e8c\u5929\u5403\u4e86 13 \u5757\u3002\u5982\u679c 1 \u5757\u997c\u5e72\u542b\u6709 200 \u5361\u8def\u91cc\uff0c\u82cf\u6bd4\u5979\u59b9\u59b9\u591a\u6444\u5165\u4e86\u591a\u5c11\u5361\u8def\u91cc\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a.swing 1.\u5468\u4e00\uff0c\u82cf\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684 4 \u500d\u3002\u5468\u4e8c\uff0c\u5979\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684\u4e24\u500d\u3002\u5979\u59b9\u59b9\u5468\u4e00\u5403\u4e86 5 \u5757\u997c\u5e72\uff0c\u7b2c\u4e8c\u5929\u5403\u4e86 13 \u5757\u3002\u5982\u679c 1 \u5757\u997c\u5e72\u542b\u6709 200 \u5361\u8def\u91cc\uff0c\u82cf\u6bd4\u5979\u59b9\u59b9\u591a\u6444\u5165\u4e86\u591a\u5c11\u5361\u8def\u91cc\uff1f; \u9010\u6b65\u89e3\u7b54\uff1a.swing 1.\u5468\u4e00\uff0c\u82cf\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684 4 \u500d\u3002\u5468\u4e8c\uff0c\u5979\u5403\u7684\u997c\u5e72\u662f\u5979\u59b9\u59b9\u7684\u4e24\u500d\u3002\u5979\u59b9\u59b9\u5468\u4e00\u5403\u4e86 5 \u5757\u997c\u5e72\uff0c\u7b2c\u4e8c\u5929\u5403\u4e86 13 \u5757"""
    #prompt = """Please follow the examples and answer the given question step-by-step.\n\nQuestion: Roger has 5 tennis balls. He buys 2 more cans of tennis balls. Each can has 3 tennis balls. How many tennis balls does he have now?; Step-by-Step Answer: Roger started with 5 balls. 2 cans of 3 tennis balls each is 6 tennis balls. 5 + 6 = 11. The answer is 11.\nQuestion: There were nine computers in the server room. Five more computers were installed each day, from monday to thursday. How many computers are now in the server room?; Step-by-Step Answer: There are 4 days from monday to thursday. 5 computers were added each day. That means in total 4 * 5 = 20 computers were added. There were 9 computers in the beginning, so now there are 9 + 20 = 29 computers. The answer is 29.\nQuestion: Leah had 32 chocolates and her sister had 42. If they ate 35, how many pieces do they have left in total?; Step-by-Step Answer: Leah had 32 chocolates and Leah\u2019s sister had 42. That means there were originally 32 + 42 = 74 chocolates. 35 have been eaten. So in total they still have 74 - 35 = 39 chocolates. The answer is 39.\nQuestion: Shawn has five toys. For Christmas, he got two toys each from his mom and dad. How many toys does he have now?; Step-by-Step Answer: He has 5 toys. He got 2 from mom, so after that he has 5 + 2 = 7 toys. Then he got 2 more from dad, so in total he has 7 + 2 = 9 toys. The answer is 9.\n\nQuestion: On Monday, Sue ate 4 times as many cookies as her sister. On Tuesday, she ate twice as many cookies as her sister. Her sister ate 5 cookies on Monday and 13 the next day. If 1 cookie has 200 calories, how many more calories did Sue consume than her sister?; Answer step-by-step::// On Monday, Sue ate 4 times as many cookies as her sister. On Tuesday, she ate twice as many cookies as her sister. Her sister ate 5 cookies on Monday and 13 the next day. If 1 cookie has 200 calories, how many more calories did Sue consume than her sister?"""
    #test_mapping('output/eval_log/Llama-3-8B_french_fr_naively-trained.json')

    '''model_name = "models/base/Llama-3.2-1B"
    model, tokenizer = load_model_from_name(model_name)
    tokenizer.pad_token_id = tokenizer.eos_token_id
    f1 = evaluate_squad(model, tokenizer, 'en')
    print(f1)'''
    
    '''model_name = "models/base/Llama-3-8B"
    outputs1 = inspect_hidden_state(model_name, lang="zh", prompt=[prompt])
    model_name = "models/Llama-3-8B_english-to-zh"
    outputs2 = inspect_hidden_state(model_name, lang="zh", prompt=[prompt])'''

    inspect_params("./output/process_log/grad.json", "Llama-3-8B_english-to-zh")
    
    
